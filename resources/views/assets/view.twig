{% extends "base" %}

{% block subtitle %}
    {% if user.isClerk() %}
        <small><a href="{{url('assets/'~asset.id~'/edit')}}" class="fa fa-edit"></a></small>
    {% endif %}
{% endblock %}

{% block content %}

    <div class="full-width row">
        <div class="large-6 columns">
            {{asset.comments|parsedown|raw}}
            <p>Tags:
                {% for tag in asset.tags %}
                <span class="secondary label">{{tag.name}}</span>
                {% endfor %}
            </p>
            <p>Categories:
                {% for cat in asset.categories %}
                <span class="label">{{cat.name}}</span>
                {% endfor %}
                {% if asset.categories.count == 0 %}
                <em>None.</em>
                {% endif %}
            </p>
        </div>
        <div class="large-6 columns">
            <div id="asset-location-map" class="map" data-latitude="{{asset.latitude}}" data-longitude="{{asset.longitude}}"></div>
        </div>
    </div>

    <h2>Job Lists</h2>
    <p><a href="{{url('job-lists')}}">Job Lists</a> that contain this Asset.</p>
    <table>
        <thead>
            <tr>
                <th>Job List</th>
                <th>Type</th>
                <th>Start date</th>
                <th>Status</th>
            </tr>
        </thead>
        {% for job in asset.jobs %}
            <tr>
                <td><a href="{{url('job-lists/'~job.jobList.id)}}">{{job.jobList.name}}</a></td>
                <td>{{job.jobList.type.name}}</td>
                <td>{{job.jobList.start_date}}</td>
                <td>{{job.jobList.status()}}</td>
            </tr>
        {% endfor %}
    </table>

    <h2>Contacts</h2>
    <dl>
    {% for contact in asset.contacts %}
        <dt>
            <a href="{{url('contacts/'~contact.id)}}">{{contact.name}}</a>
            {{contact.phone_1}}
            {% if contact.phone_2 %}or {{contact.phone_2}}{% endif %}
            <ol>
            {% for attempt in asset %}
                <li>
                    {{attempt.date_and_time}} by {{attempt.user.name}}:
                    <span class="fa fa-check">Contact made</span>
                    ({{attempt.comments}})
                </li>
            {% endfor %}
            </ol>
        </dt>
    {% endfor %}
    </dl>

    <div class="row">
        <form action="{{url('contacts/create-for-asset')}}" method="post">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
                {% if user.isClerk() %}
                <tfoot>
                    <tr>
                        <td>
                            <input type="text" name="name" required />
                        </td>
                        <td>
                            <input type="text" name="phone_1" required />
                            <input type="text" name="phone_2" />
                        </td>
                        <td>
                            <input type="hidden" name="_token" value="{{csrf_token()}}">
                            <input type="hidden" name="asset_id" value="{{asset.id}}" />
                            <input type="submit" value="Create" class="button" />
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
            </table>
        </form>
    </div>

{% endblock %}
